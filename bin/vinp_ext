#!/bin/bash

cmd=`echo $0 | awk -F '/' '{print $NF}'`
option=h
mechine_id=F8U0215311002361

# swipe_event start-x start-y delta-x delta-y
function swipe_event() {
((x_end = $1 + $3))
((y_end = $2 + $4))
echo "swipe $1 -> $x_end  $2 -> $y_end"
adb -s $mechine_id shell input swipe $1 $2 $x_end $y_end
}

# touch_event touch-x touch-y
function touch_event() {
echo "touch $1 $2"
adb -s $mechine_id shell input tap $1 $2
}

# send_string message
function send_string() {
echo "send: $1"
adb -s $mechine_id shell input text $1
}

# key_event event
function key_event() {
echo "keyboard_event: $1"
adb -s $mechine_id shell input keyevent $1
}

function cap() {
adb -s $mechine_id shell screencap -p /mnt/sdcard/screencap.png
adb -s $mechine_id pull /mnt/sdcard/screencap.png .
shotwell screencap.png
}

function adb_sleep() {
adb -s $mechine_id shell sleep $1
}

# command link router
case $cmd in
    "vinp_ext" )
        if [ $# -gt 0 ]; then
            option=$1
        else
            option=h
        fi
        ;;
    "kc" )
        while true; do
            cap
            swipe_event 600 300 -100 0
            sleep 1
        done
        exit 0;;
    "ep" )
        # key_power event
        key_event POWER
        exit 0;;
    "pd" )
        # pagedown, swipe right -> left
        swipe_event 600 300 -100 0
        exit 0;;
    "pu" )
        # pageup, swipe left -> right
        swipe_event 600 300 100 0
        exit 0;;
    "lock" )
        # power on  & send password to unlock
        loop=`echo $1 | rev`
        key_event POWER
        adb_sleep 1
        while (($loop > 0)); do
            ((remainer = loop % 10))
            ((loop = loop / 10))
            key_event KEYCODE_$remainer
        done
        exit 0;;
    "mcd" )
        adb shell input tap 750 250
        exit 0;;
    "mst" )
        adb shell input tap 50 200
        exit 0;;
    "mup" )
        adb shell input swipe 400 400 400 200
        exit 0;;
    "mct" )
        adb shell input tap 750 400
        exit 0;;
    * )
        echo "unknown key, exit"
        exit -1
        ;;
esac
# !-- end command link router

# command option router
case $option in
    "P" | "p" )
        key=POWER
        ;;
    "H" | "h" )
        key=HOME
        ;;
    "B" | "b" )
        key=BACK
        ;;
    "+" )
        key=VOLUME_UP
        ;;
    "-" )
        key=VOLUME_DOWN
        ;;
    * )
        echo "unknown key, exit"
        exit -1
        ;;
esac
# !-- end command option router

echo "send key $key"

adb -s $mechine_id shell input keyevent $key

